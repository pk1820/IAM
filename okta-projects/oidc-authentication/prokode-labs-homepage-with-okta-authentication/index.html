<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Prokode Labs - Internal Portal</title>
    <link rel="stylesheet" href="style.css"/>

    <!-- Okta Sign-In Widget CSS and JS -->
    <script src="https://global.oktacdn.com/okta-signin-widget/7.36.1/js/okta-sign-in.min.js" type="text/javascript"></script>
    <link href="https://global.oktacdn.com/okta-signin-widget/7.36.1/css/okta-sign-in.min.css" type="text/css" rel="stylesheet"/>
</head>
<body>
    <!-- Authentication Status Bar (hidden initially) -->
    <div id="auth-status" class="auth-status" style="display: none;">
        <div class="auth-container">
            <div class="auth-user-info" aria-live="polite">
                <span id="user-welcome">Welcome,</span>
                <span id="user-name" class="user-name"></span>
            </div>
            <button id="logout-btn" class="auth-logout-btn" aria-label="Logout">
                <span>Logout</span>
                <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16" aria-hidden="true">
                    <path d="M10 12.5a.5.5 0 0 1-.5.5h-8a.5.5 0 0 1-.5-.5v-9a.5.5 0 0 1 .5-.5h8a.5.5 0 0 1 .5.5v2a.5.5 0 0 0 1 0v-2A1.5 1.5 0 0 0 9.5 2h-8A1.5 1.5 0 0 0 0 3.5v9A1.5 1.5 0 0 0 1.5 14h8a1.5 1.5 0 0 0 1.5-1.5v-2a.5.5 0 0 0-1 0v2z"/>
                    <path d="M15.854 8.354a.5.5 0 0 0 0-.708l-3-3a.5.5 0 0 0-.708.708L14.293 7.5H5.5a.5.5 0 0 0 0 1h8.793l-2.147 2.146a.5.5 0 0 0 .708.708l3-3z"/>
                </svg>
            </button>
        </div>
    </div>

    <!-- Login Overlay (shown when not authenticated) -->
    <div id="login-overlay" class="login-overlay" role="dialog" aria-modal="true" aria-labelledby="portal-title">
        <div class="login-card" role="document">
            <div class="login-header">
                <div class="login-logo" aria-hidden="true">
                    <div class="logo-icon" title="Prokode Labs">
                        <svg width="40" height="40" fill="currentColor" viewBox="0 0 16 16" aria-hidden="true">
                            <path d="M8 1a2 2 0 0 1 2 2v4H6V3a2 2 0 0 1 2-2zM3 6a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V6z"/>
                        </svg>
                    </div>
                    <h1 id="portal-title">Prokode Labs</h1>
                </div>
                <p class="login-tagline">Internal Portal Access</p>
            </div>

            <div class="login-content">
                <p class="login-description">Welcome to <strong>Prokode Labs Portal</strong> â€” secure access for employees. Sign in with your Okta credentials to continue.</p>

                <!-- A11y hint for keyboard users -->
                <div class="sr-only" id="okta-hint" aria-hidden="false">
                    Use Tab to move between fields and Enter to submit. For help contact internal@prokodelabs.com.
                </div>

                <!-- Container for Okta widget -->
                <div id="okta-signin-wrapper" class="okta-signin-wrapper" aria-label="Sign-in form container">
                    <div id="okta-signin-container" class="okta-signin-container" aria-describedby="okta-hint"></div>
                </div>

                <!-- Generic area for authentication errors (populated by JS or server side) -->
                <div id="global-auth-error" class="auth-error-message" role="alert" aria-live="assertive" style="display:none;"></div>

                <div id="auth-loading" class="auth-loading" style="display: none;">
                    <div class="loading-spinner" aria-hidden="true"></div>
                    <p>Authenticating...</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Protected Content (your existing homepage wrapped) -->
    <div id="protected-content" style="display: none;">
        <!-- Fixed Navigation Bar -->
        <nav class="navbar" id="navbar" role="navigation" aria-label="Main navigation">
            <div class="nav-container">
                <div class="nav-logo">
                    <h2>Prokode Labs</h2>
                </div>
                <ul class="nav-menu" id="nav-menu">
                    <li class="nav-item"><a href="#home" class="nav-link">Home</a></li>
                    <li class="nav-item"><a href="#services" class="nav-link">Services</a></li>
                    <li class="nav-item"><a href="#projects" class="nav-link">Projects</a></li>
                    <li class="nav-item"><a href="#team" class="nav-link">Team</a></li>
                    <li class="nav-item"><a href="#resources" class="nav-link">Resources</a></li>
                </ul>
                <div class="nav-toggle" id="mobile-menu" aria-hidden="true">
                    <span class="bar"></span>
                    <span class="bar"></span>
                    <span class="bar"></span>
                </div>
            </div>
        </nav>

        <!-- (rest of your site content remains unchanged) -->
        <section id="home" class="hero">
            <div class="hero-background">
                <img src="https://pplx-res.cloudinary.com/image/upload/v1754843849/pplx_project_search_images/67c3ce153d56fea5946c1e5c059f149a2427e8d8.png" alt="Network Visualization Background" class="hero-bg-image">
                <div class="hero-overlay"></div>
            </div>
            <div class="hero-content">
                <div class="container">
                    <h1 class="hero-title">Welcome to Prokode Labs</h1>
                    <p class="hero-subtitle">Securing Digital Identities, Empowering Enterprise Access</p>
                    <a href="#services" class="hero-cta">Explore Our Services</a>
                </div>
            </div>
        </section>

        <!-- (other sections kept intact) -->
        <!-- Mission & Vision ... Services ... Projects ... Resources ... Team ... Footer (unchanged) -->
        <section class="mission-vision">
            <div class="container">
                <div class="mission-vision-grid">
                    <div class="mission-card">
                        <h3>Our Mission</h3>
                        <p>To deliver comprehensive Identity and Access Management solutions that protect organizations while enabling seamless user experiences.</p>
                    </div>
                    <div class="vision-card">
                        <h3>Our Vision</h3>
                        <p>Leading the future of secure digital identity through innovative IAM technologies and expert consulting services.</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Footer Section -->
        <footer class="footer">
            <div class="container">
                <div class="footer-content">
                    <div class="footer-section">
                        <h3>Prokode Labs</h3>
                        <p>Internal Employee Portal</p>
                    </div>
                    <div class="footer-section">
                        <h4>Quick Links</h4>
                        <ul>
                            <li><a href="#services">Services</a></li>
                            <li><a href="#projects">Projects</a></li>
                            <li><a href="#team">Team</a></li>
                            <li><a href="#resources">Resources</a></li>
                        </ul>
                    </div>
                    <div class="footer-section">
                        <h4>Contact</h4>
                        <p>Email: internal@prokodelabs.com</p>
                        <p>Phone: (555) 123-4567</p>
                    </div>
                </div>
                <div class="footer-bottom">
                    <p>&copy; 2025 Prokode Labs. All rights reserved.</p>
                    <p class="internal-notice">For Internal Use Only - Confidential</p>
                </div>
            </div>
        </footer>
    </div>

    <!-- Small runtime helper script to restyle the Okta widget and add accessibility + UI improvements.
         This script waits for the Okta widget to appear and then:
         - reduces white panels
         - styles the FastPass idp button with an icon + tooltip
         - inserts an error container under the primary button
         - adjusts checkbox size and password icon alignment
    -->
    <script>
    (function () {
        // Utility: wait for element
        function waitFor(selector, timeout = 5000) {
            return new Promise((resolve, reject) => {
                const el = document.querySelector(selector);
                if (el) return resolve(el);
                const obs = new MutationObserver(() => {
                    const el2 = document.querySelector(selector);
                    if (el2) {
                        obs.disconnect();
                        resolve(el2);
                    }
                });
                obs.observe(document.body, { childList: true, subtree: true });
                setTimeout(() => {
                    obs.disconnect();
                    reject(new Error('timeout waiting for ' + selector));
                }, timeout);
            });
        }

        // After widget loads, apply tweaks
        waitFor('.okta-sign-in-widget', 8000).then(widget => {
            // Make widget container visually match our dark theme and remove large white panels
            widget.setAttribute('aria-label', 'Okta sign-in widget');
            widget.style.background = 'transparent';
            widget.style.boxShadow = 'none';
            widget.style.border = 'none';
            widget.style.width = '100%';

            // Move and restyle Okta IDP buttons (e.g., FastPass) to be distinct
            const idpButtons = widget.querySelectorAll('.okta-idp-button, .idp-button'); // support variations
            idpButtons.forEach((btn) => {
                btn.classList.add('pk-fastpass');
                btn.setAttribute('role', 'button');
                btn.setAttribute('tabindex', '0');
                // add descriptive text if missing
                if (!btn.querySelector('.pk-fastpass-label')) {
                    const label = document.createElement('span');
                    label.className = 'pk-fastpass-label';
                    label.textContent = btn.textContent.trim() || 'Sign in with Okta FastPass';
                    btn.innerHTML = ''; // clear existing to avoid duplication then append new structured content
                    // Icon
                    const icon = document.createElement('span');
                    icon.className = 'pk-fastpass-icon';
                    icon.setAttribute('aria-hidden', 'true');
                    icon.innerHTML = '<svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M12 2C8.13 2 5 5.13 5 9c0 2.92 1.99 5.39 4.73 6.18L10 22l2-1 2 1-0.73-6.82C17.01 14.39 19 11.92 19 9c0-3.87-3.13-7-7-7z\" fill=\"currentColor\"/></svg>';
                    // Label & short help
                    const text = document.createElement('span');
                    text.className = 'pk-fastpass-text';
                    text.innerHTML = '<strong>Sign in with Okta FastPass</strong><span class=\"pk-fastpass-sub\">Quick passwordless sign-in</span>';
                    // Tooltip (visually hidden until hover)
                    const tooltip = document.createElement('span');
                    tooltip.className = 'pk-fastpass-tooltip';
                    tooltip.textContent = 'Use FastPass to sign in securely without typing your password. Requires registered device.';
                    // Assemble
                    btn.appendChild(icon);
                    btn.appendChild(text);
                    btn.appendChild(tooltip);
                }
            });

            // Make sure primary button has an error container below it (so we can show validation messages)
            const primary = widget.querySelector('.button-primary') || widget.querySelector('button[type="submit"]');
            if (primary) {
                // find parent container and add error area
                let container = primary.parentElement;
                // If wrapped inside multiple elements, find a good insertion point
                const err = document.createElement('div');
                err.id = 'okta-inline-error';
                err.className = 'okta-inline-error';
                err.setAttribute('role', 'alert');
                err.setAttribute('aria-live', 'assertive');
                // avoid duplicate
                if (!widget.querySelector('#okta-inline-error')) {
                    container.appendChild(err);
                }
            }

            // Checkbox increase (Keep me signed in)
            const checkboxes = widget.querySelectorAll('input[type="checkbox"]');
            checkboxes.forEach(cb => {
                cb.style.transform = 'scale(1.25)';
                cb.style.marginRight = '10px';
                cb.setAttribute('aria-checked', cb.checked ? 'true' : 'false');
                cb.addEventListener('change', e => cb.setAttribute('aria-checked', e.target.checked ? 'true' : 'false'));
            });

            // Adjust password visibility icon alignment
            const pwContainers = widget.querySelectorAll('.okta-form-input-field, .password-input');
            pwContainers.forEach(c => {
                c.style.display = 'flex';
                c.style.alignItems = 'center';
                c.style.gap = '8px';
            });

            // Improve focus outlines for keyboard users
            const interactive = widget.querySelectorAll('a, button, input, .pk-fastpass');
            interactive.forEach(n => {
                n.addEventListener('focus', () => n.classList.add('pk-focus'));
                n.addEventListener('blur', () => n.classList.remove('pk-focus'));
            });

            // If the widget produces validation messages internally, copy them into our inline-error area.
            const observer = new MutationObserver((mutations) => {
                mutations.forEach(m => {
                    if (m.addedNodes && m.addedNodes.length) {
                        m.addedNodes.forEach(node => {
                            if (node.nodeType === 1 && node.matches && (node.classList.contains('okta-form-error') || node.classList.contains('infobox-error'))) {
                                // move text to okta-inline-error
                                const inline = widget.querySelector('#okta-inline-error');
                                if (inline) inline.innerText = node.textContent.trim();
                            }
                        });
                    }
                });
            });
            observer.observe(widget, { childList: true, subtree: true });

        }).catch(() => {
            // Widget didn't appear; nothing fatal, we keep the original behavior
            console.warn('Okta widget did not appear in time for UI adjustments.');
        });
    })();
    </script>

    <!-- Load authentication script first (keeps existing behavior) -->
    <script src="auth.js"></script>
    <!-- Then load your existing app script -->
    <script src="app.js"></script>
</body>
</html>
